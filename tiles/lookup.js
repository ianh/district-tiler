var tree = [274276184,244722499,296713302,1835409116,1819173579,1823631051,307095723,201003153,181317764,253073070,1856151774,1809225397,1844987722,1835398605,314811146,184636533,226456194,172304358,203559667,1793155842,264706854,262236434,257964924,1795115278,287336953,287597189,1858217558,1822925805,1843440609,1848441001,323278784,179931922,1812840858,206317865,1788091598,170097261,1871945484,1877479591,222039250,1788513573,1806099871,1798167293,1794374730,1835618144,1838543863,1883720554,1870104774,291805088,286457678,283899228,292795687,282585989,1832963913,289173410,275388545,1816979053,302114414,305122544,1847423505,1844624094,1853685872,1856751244,325339289,173529026,1815632784,187597266,192164707,1812209116,1800882136,242844274,1805979439,166629128,1877573335,1842719216,1893376494,196704133,191800962,1852283398,1849224153,1786209997,247702616,249953430,248387830,257341251,257064273,267681864,1804879689,254379113,254757204,268728488,268202441,1868665418,248055558,271246487,266784831,1791790377,1782327866,279227235,291119406,279129047,1813664717,1818456618,1813940597,1833034506,1835385231,291147532,291731576,281866823,293222266,1861820492,284538484,1808561079,301579819,1828595472,1828614472,302060530,1842228474,304858386,1852069401,1838342006,308654445,312425757,1856678414,315852216,1864200125,1865075004,327977458,172587468,1830900546,1814179916,1826664568,1810932861,188398603,1814083369,1825993581,1810014149,1816131668,223831146,218701491,238561369,1785637669,241305492,239928722,74622968,1864078750,1843147549,1890097107,174626292,1845528894,1881884134,175196854,1870674221,1853223769,1889309452,1884093197,219089007,1855191383,223704105,1867110168,1781640307,251373713,245457300,251598518,1804652324,1801987571,1807790502,1809207871,1790410207,261563710,1805688414,1805114839,1790593602,268870908,267816404,268839955,249223604,1826451490,1847592960,1843290733,1821745453,1826703390,1841899169,1848115979,249121062,253896937,1895748539,1888118154,266243161,1862226564,1879056411,1877167639,290388918,285684527,1777632685,1791318217,1802852864,282668371,1801859862,1803653864,1813899270,1816903164,285607075,1819322990,291299400,290686219,295331411,1819874374,278194387,280083758,1827573604,285006080,1827628944,293059075,1839609683,1840294498,278681666,286358431,1849882088,1855119472,1860315542,1863366955,1863340797,1864248944,1770005366,298748601,299772780,302548794,299184280,298976583,304191654,305779056,299400562,1839810980,1841121285,306575251,302877919,306331664,300130232,301284800,1830854339,307692700,1845670765,311599202,310001946,1850700828,313681766,1864899459,1852832486,316513048,319479570,320807833,1862327782,1873303624,1880795622,334707770,68847278,1833199838,1827238621,174994266,184063453,183433576,1820814382,181430227,1808353655,185466211,1807071459,194493197,185840099,1816342688,195917304,199436150,1804490762,203580429,204297829,1818354117,222467053,1789212967,1820617505,1819560162,230352204,1778839207,1768371900,243497032,234825457,1799984858,1817488574,1814676957,42842194,1957976984,1857466702,1879964200,1840398824,1852324672,1881296958,1893558642,1837278608,175811431,176442959,1861136543,1877187104,174654662,1894811908,176036938,1861132391,192270963,1850209323,1875237660,188348805,187782487,196147523,194953265,208760306,1846067316,205632794,1876905372,1846375146,224768424,232489794,226554293,1768295032,250987858,247956905,252447693,1791105061,1791137679,249917423,1789695095,1799834862,247262155,1797494201,251982778,247536729,1811448329,249323086,1812625257,254694256,254375665,1794926550,1792538172,253722544,1811201129,260135085,260960020,1788930644,265720064,1790383650,1790608765,1801435501,269086304,1814800407,1810147222,1822064945,1826322725,258985310,257664444,250698920,250278982,260585192,257691562,263273146,1827260066,269368257,1832766548,267045407,1844668934,269995659,270769329,1865675375,250271767,1870106087,1878095847,1893661895,1900417979,248773918,248293821,261578385,1863336562,1859791120,1866797667,261653049,1882836972,269635660,1886229108,1791124185,1783849817,281056211,289237944,1770295407,293963983,1785876046,292388774,275696894,276677250,1803245645,1802811632,289959469,288163278,293998480,294605556,277776323,1819392885,279872858,281901890,1811541953,1810835401,285221929,285659327,1814260148,1816974931,290020693,1821698930,295085492,1810021827,294744251,295462333,1827539221,1825414029,1837145219,1837997711,284224104,285472156,1837729675,1840823059,289366907,290467462,1826205126,1827623480,288459693,289526381,292869068,294507055,1855184911,1849207891,1851483896,1849250406,289647156,1854812460,1851624103,293769964,274988886,274909594,274940598,1867523594,275639941,1868873419,288457042,1865814657,1766415734,1806655986,1813697842,301211803,297711133,1819415445,1820542576,302958575,1825470448,301475028,1831618593,1833627170,1825779167,305180422,1833169756,1834713594,1840279651,1837404289,303824062,303853742,1835546609,306312214,306152704,1842715822,300960375,1844995220,1845352580,1844905432,298583376,304081086,1853761923,1864170865,1828607248,308133116,1842984699,308139395,308297742,308120383,309893030,312696665,307460897,1850126281,313282284,314422547,311279180,1854443844,311986972,312187359,1849742513,1853663043,1853483919,317443839,318532696,320463678,1867025581,1871214880,1860758699,324672719,1868295078,1879316984,1872178957,1885089629,1886901461,337119964,];
function lookupDistrict(lng, lat, callback) {
    function encodeCoordinate(axis, c) {
        d = axis ? 180 : 360;
        return ((c / d + 0.5) * ((1<<30) - 1)) | 0;
    }
    function readCoordinate(buffer, i, last) {
        if ((buffer[i] & 0xc0) === 0x80) {
            // Absolute coordinate.
            return ((buffer[i] & 0x3f) << 24) + (buffer[i + 1] << 16) + (buffer[i + 2] << 8) + buffer[i + 3];
        } else if ((buffer[i] & 0x80) === 0x00) {
            // Relative coordinate.
            d = (buffer[i] << 8) + buffer[i + 1];
            if (d & 0x4000)
                d = -((~d + 1) & 0x7fff);
            return last + d;
        } else {
            throw "Invalid byte in tile data.";
        }
    }
    function orientation(x0, y0, x1, y1, px, py) {
        return (x1 - x0) * (py - y0) - (px - x0) * (y1 - y0);
    }
    var px = encodeCoordinate(0, lng);
    var py = encodeCoordinate(1, lat);
    var index = 0;
    var tilenum = 0;
    while (index < tree.length) {
        tilenum *= 2;
        var cutoff = tree[index];
        var axis = 0;
        if (cutoff & 0x40000000) {
            axis = 1;
            cutoff &= 0x3fffffff;
        }
        var lower = false;
        if (axis === 0)
            lower = (px < cutoff);
        else
            lower = (py < cutoff);
        if (lower) {
            index = 2 * index + 1;
        } else {
            tilenum += 1;
            index = 2 * index + 2;
        }
    }
    var request = new XMLHttpRequest();
    request.open("GET", "tiles/tile-" + ("0000" + tilenum).slice(-4), true);
    request.responseType = "arraybuffer";
    request.onreadystatechange = function () {
        if (request.readyState !== 4)
            return;
        if (request.status !== 200 && window.location.protocol !== "file:") {
            callback("failed");
            return;
        }
        var buffer = new Uint8Array(request.response);
        var state = -1;
        var district = -1;
        var lastx = -1;
        var lasty = -1;
        var winding = 0;
        for (var i = 0; i + 2 <= buffer.length; i += 2) {
            if (buffer[i] === 0xff) {
                if (buffer[i + 1] === 0xff) {
                    // New part in this district.
                } else {
                    // Entirely new district.
                    if (winding > 0)
                        break;
                    winding = 0;
                    state = buffer[i + 2];
                    district = buffer[i + 3];
                    i += 2;
                }
                lastx = -1;
                lasty = -1;
                continue;
            }
            var x = readCoordinate(buffer, i, lastx);
            if ((buffer[i] & 0xc0) === 0x80)
                i += 2;
            i += 2;
            var y = readCoordinate(buffer, i, lasty);
            if ((buffer[i] & 0xc0) === 0x80)
                i += 2;

            if (lastx != -1 && lasty != -1) {
                // Check if this edge crossed the query point vertically.  We count these crossings to determine whether the query point is inside the current district.
                if (lasty <= py) {
                    if (y > py) {
                        if (orientation(lastx, lasty, x, y, px, py) > 0)
                            winding--;
                    }
                } else {
                    if (y <= py) {
                        if (orientation(lastx, lasty, x, y, px, py) < 0)
                            winding++;
                    }
                }
            }
            lastx = x;
            lasty = y;
        }
        if (winding > 0)
            callback("found", state, district);
        else
            callback("notfound");
    };
    request.timeout = 10000;
    request.send();
}
