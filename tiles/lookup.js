var tree = [274229086,244603923,297285073,1835861650,1818978546,1823096423,307636728,200944742,183370586,253133140,1855942406,1809066954,1844258264,1839248602,314778993,184417377,225514696,172366170,203480723,1793512605,264725940,262082704,257851406,1794831536,287905911,287834937,1857233002,1823787388,1845634884,1849734341,323267644,179502974,1813030469,206038824,1788073297,170148520,1872489042,1877518663,221624977,1788443493,1806099006,1798225126,1794371437,1834514504,1838508877,1883872996,1870103898,291951362,286338123,283951529,293728768,282543379,1832756329,288940771,275649199,1818771111,301913836,306199012,1851089373,1846113457,1854029732,1856695350,325344270,173460098,1816545566,187543534,191786386,1812394593,1802025433,242680171,1806007255,167078609,1877632748,1842858820,1892536124,1866743533,193665276,1852442038,1849092405,1786018650,248022523,249955171,248402162,257362171,257267082,267683293,1804886549,252131849,254755206,268671124,267939557,1868436472,248053783,271222704,265992266,1791707006,1781889600,279284033,290873525,279129787,1813647996,1817724636,1813465776,1832846023,1834521090,291622015,292145655,282764415,293128141,1860868292,287306766,1809042622,302274769,1832396602,1833496412,303905314,1842799389,303479808,300683779,1843635440,311606221,312344215,1857514543,315809577,1864203984,1865253299,327976963,172297561,1831285888,1814223080,1828795534,1811129111,188252132,1814067561,1825941230,1810120086,1816287957,223558911,217639357,238083983,1785778842,240866943,239432773,76062054,1863682975,1843294676,1890951126,174817961,1846093581,173679654,175491429,202272072,193136178,1889651177,1882332057,218946262,1855190107,223574131,1867108021,1779414321,250583012,245438843,251617431,1804434653,1802004208,1807727539,1809213263,1790552686,261994451,1805698167,1805164696,1790594180,268873065,267817976,268840265,1823717487,257644329,1847214388,1843148074,1821540601,1826412561,1841880624,1847956630,249146155,253170745,1895764370,1888082308,266480491,1862071008,1879078661,1877168862,290431203,285809749,1777272349,1791117403,1801585622,1803221307,1801767896,1803557901,1813435073,1816815761,285697800,1819320324,291632791,290927069,295415321,1817630916,278138404,279558809,1827048992,284964828,1825467716,293219806,1839622216,1839007541,279306226,1848657104,1849501405,1853978675,1860070884,1863211817,1865748729,1863540537,1805359347,300252701,300177527,302645099,298819754,300067087,304254477,305735621,300678556,1842717396,1842299955,306859554,300633355,305968712,1852427530,1856500973,1832377293,308336313,309828751,312637341,310348073,314066810,313069110,1864886825,1852825149,316426143,319549989,320804158,1862373607,1873614598,1880798223,334710368,68732239,1833315224,1827787959,174532372,183811318,183328468,1824229441,181193374,1808873621,185370072,1807785867,191795260,185537307,1815974872,195868690,196698165,1806146120,203504862,204237007,1818893141,222172120,1790142869,1820704413,1819942825,229911743,1778827670,1769348946,243459824,234809885,1801706997,1817992415,1815653579,42781984,1952900971,1856154536,1879501853,1840500364,1853675856,1881801038,1895616260,1837761028,175811431,176818962,1861194048,1877337153,174853493,1894310232,176868503,195196280,1852477734,190778026,199485330,188396375,190794932,194914178,1887347965,208711641,1846181478,205485554,1876757947,1845972111,224620042,232073537,226555190,1767642347,250965574,247439645,252382657,1790955906,246003288,250040573,1789609183,1799785428,247298382,1797547894,251991248,247557548,1810196334,249323874,1812629176,254856394,254401393,1794929586,1792529558,253742217,1811194359,260159450,260923793,1788930483,266659728,1790361375,1790648822,1801442325,269066115,1814784987,1810143494,247629805,250536137,1827031997,1826113232,250698678,250282821,260405110,257572901,263141505,1826793698,269253271,1832589070,267035892,1844594971,1844555183,270965832,1865629508,250344913,1870101869,1877600799,1893695914,1900433829,248769927,248294710,261349108,1863073191,1859699554,1866684513,261519025,1882056475,269499340,1886382170,1790847924,1783678824,281266431,289500641,1769314145,293694740,1784720413,292640224,275602157,277329527,282944597,280693012,289924826,288028684,293966918,294562493,277643537,277626041,279894163,282097770,1811545317,1810829507,285250392,286186883,1813588809,1816698628,290528003,292043310,1809800940,1809863348,295519161,295930452,1827419320,1825325165,1836951743,1837946451,285036488,285584520,1836975007,1839636497,289766067,289705601,1826604475,1825205556,289876922,289730813,293062893,295160868,1853242262,1850061009,285462397,285260864,289491291,290489838,1849938107,293876936,275187997,275069244,274902644,1867695805,281399587,1872325809,289198502,1864736155,1766699261,298317523,1813559776,302480104,299437093,1820899768,1821168078,305687517,1828269228,1826130448,1833747852,1834589046,1826609569,1829399323,305434460,1834544390,299283190,302897730,305503862,305677892,1841728194,306983992,1843397797,1844173140,299422803,301778148,1847522409,1847026394,298838750,1856154226,303835154,1864262658,1829751021,308273403,1844879626,308537389,308641244,1848243421,1848398314,313209407,309019577,1850723120,1850773258,1852686278,311375637,1854640757,311861825,1867645625,1849748037,1853607256,1853447078,317135830,318593351,1859566839,1867024728,1871201393,1860752334,324676289,1868951039,1879360047,1872162714,1885106773,1886261063,337154407,];
function lookupDistrict(lng, lat, callback) {
    function encodeCoordinate(axis, c) {
        d = axis ? 180 : 360;
        return ((c / d + 0.5) * ((1<<30) - 1)) | 0;
    }
    function readCoordinate(buffer, i, last) {
        if ((buffer[i] & 0xc0) === 0x80) {
            // Absolute coordinate.
            return ((buffer[i] & 0x3f) << 24) + (buffer[i + 1] << 16) + (buffer[i + 2] << 8) + buffer[i + 3];
        } else if ((buffer[i] & 0x80) === 0x00) {
            // Relative coordinate.
            d = (buffer[i] << 8) + buffer[i + 1];
            if (d & 0x4000)
                d = -((~d + 1) & 0x7fff);
            return last + d;
        } else {
            throw "Invalid byte in tile data.";
        }
    }
    function orientation(x0, y0, x1, y1, px, py) {
        return (x1 - x0) * (py - y0) - (px - x0) * (y1 - y0);
    }
    var px = encodeCoordinate(0, lng);
    var py = encodeCoordinate(1, lat);
    var index = 0;
    var tilenum = 0;
    while (index < tree.length) {
        tilenum *= 2;
        var cutoff = tree[index];
        var axis = 0;
        if (cutoff & 0x40000000) {
            axis = 1;
            cutoff &= 0x3fffffff;
        }
        var lower = false;
        if (axis === 0)
            lower = (px < cutoff);
        else
            lower = (py < cutoff);
        if (lower) {
            index = 2 * index + 1;
        } else {
            tilenum += 1;
            index = 2 * index + 2;
        }
    }
    var request = new XMLHttpRequest();
    request.open("GET", "tiles/tile-" + ("0000" + tilenum).slice(-4), true);
    request.responseType = "arraybuffer";
    request.onreadystatechange = function () {
        if (request.readyState !== 4)
            return;
        if (request.status !== 200 && window.location.protocol !== "file:") {
            callback("failed");
            return;
        }
        var buffer = new Uint8Array(request.response);
        var state = -1;
        var district = -1;
        var lastx = -1;
        var lasty = -1;
        var winding = 0;
        for (var i = 0; i + 2 <= buffer.length; i += 2) {
            if (buffer[i] === 0xff) {
                if (buffer[i + 1] === 0xff) {
                    // New part in this district.
                } else {
                    // Entirely new district.
                    if (winding > 0)
                        break;
                    winding = 0;
                    state = buffer[i + 2];
                    district = buffer[i + 3];
                    i += 2;
                }
                lastx = -1;
                lasty = -1;
                continue;
            }
            var x = readCoordinate(buffer, i, lastx);
            if ((buffer[i] & 0xc0) === 0x80)
                i += 2;
            i += 2;
            var y = readCoordinate(buffer, i, lasty);
            if ((buffer[i] & 0xc0) === 0x80)
                i += 2;

            if (lastx != -1 && lasty != -1) {
                // Check if this edge crossed the query point vertically.  We count these crossings to determine whether the query point is inside the current district.
                if (lasty <= py) {
                    if (y > py) {
                        if (orientation(lastx, lasty, x, y, px, py) > 0)
                            winding--;
                    }
                } else {
                    if (y <= py) {
                        if (orientation(lastx, lasty, x, y, px, py) < 0)
                            winding++;
                    }
                }
            }
            lastx = x;
            lasty = y;
        }
        if (winding > 0)
            callback("found", state, district);
        else
            callback("notfound");
    };
    request.timeout = 10000;
    request.send();
}
